/**
 * prometheus - 普罗米修斯
 * @author 
 * @version v1.0.91
 * @link 
 * @license MIT
 */
define(["angular","angularUiRouter","uiRouterExtras","oclazyload","./hb-nice-scroll"],function(e){function t(){return function(e){var t=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i);return t&&parseFloat(t[1])}(navigator.userAgent)}return e.module("hb.nav",["ui.router","oc.lazyLoad","hb.niceScroll","ct.ui.router.extras"]).provider("sideMenu",[function(){this.setLoadMenuUrl=function(e){this.menuUrl=e},this.sync=!0,this.menuUrl="datas/hb.menu.json",this.setOptions=function(e){var e=e||{};this.menuUrl=e.menuUrl||"datas/hb.menu.json",this.sync=e.sync},this.setTemplateUrl=function(e){this.menuTemplateUrl=e.menuTemplateUrl||"templates/tpls/tpl-hb-side-menu.html",this.tabTemplateUrl=e.tabTemplateUrl||"templates/tpls/tpl-hb-tab.html"},this.scrollOptions={autohidemode:!1,cursorborder:"none",cursorcolor:"rgb(47, 64, 74)"},this.setScrollOptions=function(t){this.scrollOptions=e.extend(this.scrollOptions,t)};var t=this,n=this;this.$get=["$http",function(e){return{sync:t.sync,loadMenu:function(){return e.get(n.menuUrl)},getSrollOptions:function(){return t.scrollOptions},getTemplateUrl:function(){return{menuTemplateUrl:n.menuTemplateUrl,tabTemplateUrl:n.tabTemplateUrl}}}}]}]).provider("hbTab",function(){var t=function(){};t.prototype={appendNewTab:e.noop},this.$get=[function(){return new t}]}).factory("TabService",["$rootScope","$state",function(e,t){var n={HB_TAB:{tabs:[]}};return n.findView=function(e){for(var t,n=0;n<this.HB_TAB.tabs.length;n++)if(e[this.HB_TAB.tabs[n].viewName]){t=this.HB_TAB.tabs[n];break}return t},n.goAnyWay=function(t){var n={};if(t.unListed){var a={state:t.name,name:t.title};this.newState(n,a,t)}else for(var i=0;i<e.menuList.length;i++){var s=e.menuList[i];if(s.subs)for(var r=0;r<s.subs.length;r++){var o=s.subs[r];this.newState(n,o,t)}else this.newState(n,s,t)}n.state&&this.appendNewTab(n.state.name,n.state.activeView.stateName,n.state.activeView.params,n.state.viewName,!0)},n.compare2State=function(e,t){return new RegExp("^"+e+".").test(t)||e===t},n.newState=function(e,t,n){if(this.compare2State(t.state,n.name)){var a={params:n.$stateParams,stateName:n.name};e.state={name:t.name,viewName:t.state,position:"index",closeAble:!0,subs:[],activeView:a}}},n.changeCurrent=function(e,n){return t.go(e,n)},n.appendNewTab=function(t,a,i,s,r){var o={};o[s||a]=!0;var l=this.findView(o);n.from="0",l?(l.params=i,l.activeView={stateName:a,params:i}):(l={name:t,viewName:s||a,params:i,activeView:{stateName:a,params:i},closeAble:r},this.HB_TAB.tabs.push(l)),this.HB_TAB.tabs.length>1&&(this.changeCurrent(a,i),e.$broadcast("events:addTab",l))},n.init=function(){var t=e.menuList[0];n.appendNewTab(t.name,t.state,void 0,void 0,!1)},n}]).directive("hbSideMenu",["sideMenu","$rootScope","$timeout","TabService","$state","sideMenu",function(n,a,i,s,r,n){return{templateUrl:function(e,t){return t.templateUrl||n.getTemplateUrl().menuTemplateUrl},replace:!0,compile:function(s){return function(s,o,l){function u(){if(c.nice.length<=0){var t=s.$eval(l.niceOption);t=e.extend({},t,n.getSrollOptions()),c.niceScroll(t),c.nice=c.getNiceScroll()}}var c=o.find(".ul-side");c.nice=c.getNiceScroll(),c.css({overflow:"hidden"});var m;s.model=s.model||{},s.model.currentMenuName="states.home",s.isIe8=8===t(),s.showMenu=!1,s.events={init:function(e){e&&u()},toggleSideNav:function(){s.showMenu=!s.showMenu,s.model.nowMarginLeft=0,s.showMenu?(s.model.sideStyle={marginLeft:"-250px"},a.contentStyle={marginLeft:0},s.model.nowMarginLeft=-250,i.cancel(m),c.nice.hide()):(m=i(function(){c.nice.show()},500),s.model.sideStyle={marginLeft:0},a.contentStyle={marginLeft:"250px"},s.model.nowMarginLeft=0),a.$broadcast("events:changeSideWidth",s.model.nowMarginLeft)},toggleSub:function(t,n,i,o){var l=$(t.target),u=l.closest("li"),c=$('<span class="ink"></span>'),m=Math.max(u.outerWidth(),u.outerHeight());if(u.find(".ink").remove(),u.css({position:"relative",overflow:"hidden"}),c.css({width:m,height:m,top:t.pageY-u.offset().top-m/2+"px",left:t.pageX-u.offset().left-m/2+"px"}),u.find(">a").append(c),c.addClass("animate-ink"),n.showSub=!n.showSub,n.subs&&n.subs.length>0){e.forEach(a.menuList,function(e){e.name!==n.name&&(e.showSub=!1)});var f=u.find("ul");f.is(":visible")?f.slideUp():f.slideDown().parent().siblings().find("ul").slideUp()}return n.subs?(n.subs.length<=0,!1):(s.model.currentMenu=i,s.model.currentMenuName=o,void r.go(n.state,n.name))}}}}}}]).run(["$rootScope","sideMenu","$stateParams","TabService",function(t,n,a,i){t.menuList=[],n.loadMenu().then(function(n){t.menuList=n.data,t.menuList&&t.menuList.length>0&&i.init(),t.$on("$stateChangeSuccess",function(t,n){n.$stateParams=a;var s,r=n.$$state().includes;"0"===i.from?(i.goAnyWay(n),s=i.findView(r),s.activeView.stateName=n.name,s.activeView.params=e.copy(a),i.from="1"):r&&r[n.name]&&(s=i.findView(r),s?(s.activeView.stateName=n.name,s.activeView.params=e.copy(a)):i.goAnyWay(n))})})}]).directive("hbTab",["$rootScope","$state","hbTab","$stateParams","$timeout","TabService","sideMenu",function(e,t,n,a,i,s,r){return{restrict:"A",replace:!0,templateUrl:function(e,t){return t.templateUrl||r.getTemplateUrl().tabTemplateUrl},link:function(n,a,r,o){var l=a.find(".nav");n.$state=t,s.from="0",n.style={},n.HB_TAB=s.HB_TAB,n.$on("events:addTab",function(e){n.style.width=126*n.HB_TAB.tabs.length+u.outerWidth()}),n.$on("events:clickMenuItem",function(e){n.HB_TAB.currentTab=e.parentView||e.view}),n.style.left=0,n.closeTab=function(e,a,r){e.stopPropagation(),s.from="0";var o;n.HB_TAB.tabs.splice(a,1),t.includes(r)&&(o=n.HB_TAB.tabs[a-1],i(function(){s.changeCurrent(o.activeView.stateName,o.activeView.params)})),n.style.left<0&&(n.style.left+=126,n.style.left>0&&(n.style.left=0))},n.navToolClick=function(e){var a=$(e.target),i=a.data(),r={refresh:function(){t.reload(t.current)},closeAll:function(){s.init(),n.HB_TAB.tabs=n.HB_TAB.tabs.slice(0,1)}};r[i.action]&&r[i.action]()},n.mouseEnter=function(e){var t=$(e.target).closest("a").find(".title-content");t.stop().fadeOut(function(){t.next().fadeIn()})},n.mouseLeave=function(e){};var u=l.find(".nav-tool");n.clickTab=function(t,a,i,r){s.from="1",n.HB_TAB.currentTab=r,s.changeCurrent(a,i),e.$broadcast("events:clickMenuItem",!0),t.preventDefault()},n.goRight=function(){var e=l.width();n.style.width+40>e&&(n.style.left-=126,n.style.width+n.style.left<e&&(n.style.left=e-(n.style.width+40)))},n.goLeft=function(){if(n.style.left+=126,n.style.left>=0)return n.style.left=0,!1}}}}])});