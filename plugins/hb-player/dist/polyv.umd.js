!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.HBPlayer=factory()}(this,function(){"use strict";var WebApi={loadJS:function(scriptPath){if(scriptPath){var _path=scriptPath,script=document.createElement("script");return script.src=_path,document.getElementsByTagName("head")[0].appendChild(script),new Promise(function(res,rej){script.onreadystatechange=function(){"loaded"!==script.readyState&&"complete"!==script.readyState||(script.onreadystatechange=null,res())},script.onload=function(){res()},script.onerror=function(){return rej()}})}return new Promise(function(res,rej){res()})},tip_for_error_create_flash:function(){var options=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{},insiderContainerId=options.id+"_insider",flashContainer=document.getElementById(insiderContainerId);flashContainer&&(flashContainer.parentNode.removeChild(flashContainer),flashContainer=undefined),(flashContainer=document.createElement("div")).style.textAlign="center",flashContainer.style.padding="20px",flashContainer.id=insiderContainerId;var title=document.createElement("div");title.innerHTML="\u6211\u4eec\u9700\u8981Flash player 10.1.0\u6216\u4ee5\u4e0a\u7248\u672c\u6765\u64ad\u653e\u3002",title.setAttribute("style","text-align: center;font-size: 25px;padding: 15px;font-weight: bold;"),title.setAttribute("class","player-init-error"),flashContainer.appendChild(title);var adobeContainer=document.createElement("p"),adobeLink=document.createElement("a");adobeLink.style.display="inline-block",adobeLink.href="http://www.adobe.com/go/getflashplayer";var img=document.createElement("img");img.src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif",img.alt="\u5b89\u88c5\u6700\u65b0\u7684Flash player",adobeLink.appendChild(img),adobeContainer.appendChild(adobeLink),flashContainer.appendChild(adobeContainer),document.getElementById(options.id).appendChild(flashContainer)}},Asserts=function(flag,msg){if(flag)throw new Error(msg)},prototypeString=Object.prototype.toString,isFunction=function(func){return"[object Function]"===prototypeString.call(func)},isArray=function(arr){return"[object Array]"===prototypeString.call(arr)},isUndefined=function(unde){return"[object Undefined]"===prototypeString.call(unde)||!!isArray(unde)&&unde.length};function _extend(dest,source){Object.keys(source).forEach(function(key){dest[key]&&"[object Object]"===Object.prototype.toString.call(source[key])?extend(dest[key],source[key]):dest[key]=source[key]})}var _ERROR_TYPE,extend=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var other=args.slice(1),first=args[0];return other.forEach(function(item){_extend(first,item)}),first},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},TikTok=function(){function TikTok(handle,time){classCallCheck(this,TikTok),this._intervalId=setInterval(handle,time)}return TikTok.prototype.stop=function(){clearInterval(this._intervalId)},TikTok}(),Timer=function(){function Timer(){classCallCheck(this,Timer),this._list={}}return Timer.prototype.add=function(id,handle,time){this._list[id]=new TikTok(handle,time)},Timer.prototype.remove=function(id){this._list[id]&&(this._list[id].stop(),delete this._list[id])},Timer.prototype.clear=function(){var _this=this;Object.keys(this._list).forEach(function(timer){_this.remove(timer)}),this._list={}},Timer.prototype.get=function(id){return this._list[id]},Timer}(),ERROR_TYPE_CODE_et_10000="et_10000",ERROR_TYPE_CODE_et_10001="et_10001",ERROR_TYPE_CODE_et_10002="et_10002",ERROR_TYPE_CODE_et_10003="et_10003",ERROR_TYPE=((_ERROR_TYPE={})["et_00000"]="\u521d\u59cb\u5316\u5931\u8d25",_ERROR_TYPE[ERROR_TYPE_CODE_et_10000]="\u5e93\u6ca1\u6709\u52a0\u8f7d\u5b8c\u6210\u3002\u521d\u59cb\u5316\u52a8\u4f5c\u5b8c\u6210\u5931\u8d25\uff01",_ERROR_TYPE[ERROR_TYPE_CODE_et_10001]="\u63d0\u4f9b\u7684\u6a21\u5f0f\u65e0\u6cd5\u4e0e\u7cfb\u7edf\u5339\u914d",_ERROR_TYPE[ERROR_TYPE_CODE_et_10002]="\u91cd\u590d\u64ad\u653e",_ERROR_TYPE[ERROR_TYPE_CODE_et_10003]="\u9700\u8981\u5237\u65b0\u64ad\u653e",_ERROR_TYPE),BUILD_IN={buildInEventName:"build_in_event",timers:{timing:"bi_playerTimerWalking"}},PLAY_STATE={not_open:"not_open",playing:"playing",pause:"pause",not_ready:"not_ready",end:"end"},Player=function(){function Player(){classCallCheck(this,Player),this.version="0.0.1",this.name="hb-player",this._events={init:{},start:{},end:{},destroy:{},playing:{},resume:{},pause:{},seek:{},volumeUp:{},volumeDown:{},mute:{},ready:{},beforeCommit:{},afterCommit:{},error:{}},this._ts=new Timer}return Player.prototype.getSchedule=function(){var _duration=void 0,_currentTime=void 0;try{_duration=this.getDuration(),_currentTime=this.getTime()}catch(e){console.log(e)}return parseFloat((_currentTime/_duration*100).toFixed(2))},Player.prototype.getTime=function(){},Player.prototype.play=function(time){},Player.prototype.getState=function(){},Player.prototype.getDuration=function(){},Player.prototype.start=function(){},Player.prototype.stop=function(){},Player.prototype.pause=function(){},Player.prototype.resume=function(){},Player.prototype.getVolume=function(){return 0},Player.prototype.setVolume=function(volume){return volume},Player.prototype.getMute=function(){},Player.prototype.setMute=function(flag){},Player.prototype.getDefinitions=function(){},Player.prototype.getPlayerVersion=function(){},Player.prototype.setDefinition=function(name){},Player.prototype.seek=function(time){},Player.prototype.getVersion=function(){return this.version},Player.prototype.resize=function(){},Player.prototype.destroy=function(){},Player.prototype.commit=function(){},Player.prototype.setOption=function(property,value){},Player.prototype.on=function(type,id,handle){if(Asserts(isUndefined(id)&&isUndefined(handle),"\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u65b9\u5f0f\u4e0d\u6b63\u786e!"),Asserts(isUndefined(this._events[type]),type+" -> \u5f53\u524d\u4e8b\u4ef6\u4e0d\u5728\u4e8b\u4ef6\u5217\u8868\u5f53\u4e2d"),!handle&&isFunction(id)&&(handle=id,id=BUILD_IN.buildInEventName),isFunction(this._events[type][id])){var cache=this._events[type][id];this._events[type][id]=[cache]}return isArray(this._events[type][id])?this._events[type][id].push(handle):this._events[type][id]=handle,this},Player.prototype.off=function(type,id){return Asserts(isUndefined(this._events[type]),type+" -> \u5f53\u524d\u4e8b\u4ef6\u4e0d\u5728\u4e8b\u4ef6\u5217\u8868\u5f53\u4e2d"),Asserts(isUndefined(this._events[type][id]),id+" -> \u6307\u5b9a\u4e8b\u4ef6\u540d\u79f0\u4e0d\u5b58\u5728"),id?delete this._events[type][id]:this._events[type]={},this},Player.prototype.trigger=function(type,id,options){var _this=this;return Asserts(isUndefined(this._events[type]),type+" -> \u5f53\u524d\u4e8b\u4ef6\u4e0d\u5728\u4e8b\u4ef6\u5217\u8868\u5f53\u4e2d"),options?(options.eventType=id,triggerFun.call(this,this._events[type][id],options)):(options=id,Object.keys(this._events[type]).forEach(function(event){options.eventType=event,triggerFun.call(_this,_this._events[type][event],options)})),this},Player}();function triggerFun(func,options){var _this2=this;isFunction(func)&&func.call(this,options),isArray(func)&&func.forEach(function(event){event.call(_this2,options)})}var Config={token:window.token||"",width:"100%",height:"100%"},config=extend({},Config,{});var VideoPlayer=function(_Player){function VideoPlayer(){var options=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};classCallCheck(this,VideoPlayer);var _this=possibleConstructorReturn(this,_Player.call(this));_this.options=extend({},config,options),_this.lib_name="polyv",Asserts(!polyvObject,"<"+_this.lib_name+"> "+ERROR_TYPE.et_10000);var sourceElement=document.getElementById(_this.options.boxId);return sourceElement.style.position="absolute",sourceElement.style.top=0,sourceElement.style.bottom=0,_this.$el_innerDiv=document.createElement("div"),_this.$el_innerDiv.id=_this.options.boxId+"_new_polyv_dom",document.getElementById(_this.options.boxId).appendChild(_this.$el_innerDiv),_this.$el_innerDiv.style.position="absolute","100%"!==_this.options.width?(_this.$el_innerDiv.style.left="50%",_this.$el_innerDiv.style.marginLeft="-"+parseInt(_this.options.width)/2+"px"):_this.$el_innerDiv.style.width=_this.options.width,"100%"!==_this.options.height?(_this.$el_innerDiv.style.top="50%",_this.$el_innerDiv.style.marginTop="-"+parseInt(_this.options.height)/2+"px"):_this.$el_innerDiv.style.height=_this.options.height,polyvObject("#"+_this.$el_innerDiv.id).videoPlayer({width:_this.options.width,height:_this.options.height,vid:_this.options.id,flashvars:_this.options.flashvars}),function(){var _this2=this,eventMapper={s2j_onPlayerInitOver:"init",s2j_onReadyPlay:"ready",s2j_onPlayStart:"start",s2j_onPlayOver:"end",s2j_onVideoPlay:"resume",s2j_onVideoPause:"pause",s2j_onVideoSeek:"seek",s2j_onPptDataParam:"dataParam",s2j_onInteractionData:"interData",s2j_onFullScreen:"fullScreen",s2j_onNormalScreen:"exitFullScreen",onbuffer:"buffer",s2j_onPlayerError:"error"};Object.keys(eventMapper).forEach(function(key){var value=eventMapper[key],exactlyEvent=_this2._events[value];exactlyEvent&&(window[key]=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];"start"===value&&function(){if(this.currentTime=0,this._ts.get(BUILD_IN.timers.timing))return;(function(){var _this3=this;this._ts.add(BUILD_IN.timers.timing,function(){var currentTime=_this3.getTime();_this3.currentTime=currentTime,_this3.getState()===PLAY_STATE.playing&&_this3.trigger("playing",{time:_this3.getTime(),duration:_this3.getDuration()})},1e3)}).call(this)}.call(_this2),Object.keys(exactlyEvent).forEach(function(eventKey){isFunction(exactlyEvent[eventKey])&&exactlyEvent[eventKey].call(_this2,args)})})})}.call(_this,null),_this._swfPlayer=function(movieName){if(-1!==navigator.appName.indexOf("Microsoft")){var reObj=window[movieName];try{return 0<reObj.length?reObj[0]:reObj}catch(e){}return undefined}return document[movieName]}(_this.options.id),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(VideoPlayer,_Player),VideoPlayer.prototype.getDuration=function(){return this._swfPlayer?this._swfPlayer.j2s_getDuration():0},VideoPlayer.prototype.getTime=function(){return this._swfPlayer?this._swfPlayer.j2s_getCurrentTime():0},VideoPlayer.prototype.pause=function(){return this._swfPlayer&&this._swfPlayer.j2s_pauseVideo()},VideoPlayer.prototype.resume=function(){this._swfPlayer&&this._swfPlayer.j2s_resumeVideo()},VideoPlayer.prototype.play=function(time){var num;num=time,"[object Number]"===prototypeString.call(num)?this.seek(time):this.resume()},VideoPlayer.prototype.stop=function(){this._swfPlayer&&this._swfPlayer.j2s_stopVideo()},VideoPlayer.prototype.seek=function(){var time=0<arguments.length&&arguments[0]!==undefined?arguments[0]:0;this._swfPlayer&&this._swfPlayer.j2s_seekVideo(time)},VideoPlayer.prototype.mute=function(){return this.setVolume(0)},VideoPlayer.prototype.unmute=function(){return this.setVolume(100)},VideoPlayer.prototype.setVolume=function(vol){return this._swfPlayer&&this._swfPlayer.j2s_setVolume(vol)},VideoPlayer.prototype.getState=function(){return{FLOW_PAUSE:"pause",FLOW_PLAY:"playing",FLOW_COVER:"cover"}[this._swfPlayer.j2s_getCurrentStatus()]},VideoPlayer.prototype.destroy=function(){this._swfPlayer&&this._swfPlayer.parentNode.removeChild(this._swfPlayer),this.$el_innerDiv&&this.$el_innerDiv.parentNode&&this.$el_innerDiv.parentNode.removeChild(this.$el_innerDiv),this._ts.clear(),this._swfPlayer=undefined},VideoPlayer}(Player);return function(){function PlayerManager(){var options=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};classCallCheck(this,PlayerManager),this.options=options}return PlayerManager.prototype.init=function(){var _this=this;return WebApi.loadJS.call(this,this.options.script).then(function(){return new VideoPlayer(_this.options)})},PlayerManager}()});